<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.care.user.mapper.BookingMapper">

<insert id="parentsInsert" parameterType="com.care.user.dto.BookingDTO">

    <selectKey resultType="int" keyProperty="pNo" order="AFTER">
       select max(p_no) from parents_g4
    </selectKey>
     
    	insert into parents_g4 (p_name, p_phone, p_sub_phone)
	values(#{pName} , #{pPhone}, #{pSubPhone} )

	
</insert>

 
 <select id="selectTeacher" resultType="com.care.user.dto.BookingDTO">
 	select 
 	t_addr as  boAddr , bo_date as boDate , bo_time as boTime
    from teacher_g4 
    join booking_g4 
    on booking_g4.t_no = teacher_g4.t_no
		where t_addr = #{boAddr}
		and bo_date =#{boDate}
		and bo_time not in (#{boTime});
 </select>


<insert id="bookingInsert" parameterType="com.care.user.dto.BookingDTO">
	   
     insert into booking_g4(p_no, t_no, bo_addr, bo_date, bo_time, bo_hour, bo_road_name, bo_remarks, bo_cancel, bo_payment)
   		values((select max(p_no) from parents_g4 ), 3 , #{boAddr}, #{boDate}, #{boTime}, #{boHour}, #{boRoadName},
  		  	#{boRemarks}, 0 , 0)

</insert>


<select id="payment" parameterType="com.care.user.dto.BookingDTO" resultType="com.care.user.dto.BookingDTO">


	select bo_payment as boPayment 
	from booking_g4 
	


<![CDATA[

<if test='boHour ==0'>
    bo_payment = 10000
</if>
<if test='boHour ==1'>
    bo_payment = 20000
</if>
<if test='boHour ==2'>
    bo_payment = 30000
</if>
<if test='boHour ==3'>
    bo_payment = 40000
</if>

      ]]>  




</select>



</mapper>